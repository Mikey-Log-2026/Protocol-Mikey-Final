<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol-Mikey | Final</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: #00e5ff; font-family: 'Courier New', monospace; overflow: hidden; }
        /* 初期状態で opacity を 0.5 にし、z-index を調整して確実に見えるようにします */
        #bg-image { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.5; transition: opacity 1.5s ease-in-out; filter: brightness(0.4) contrast(1.2); z-index: -1; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 20%, #000 90%); z-index: 0; pointer-events: none; }
        #content { position: relative; z-index: 10; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; padding: 40px; box-sizing: border-box; }
        #terminal-text { font-size: 1.25rem; line-height: 1.8; min-height: 5em; margin-bottom: 30px; text-shadow: 0 0 10px #00e5ff; white-space: pre-wrap; }
        button { background: rgba(0, 229, 255, 0.05); color: #00e5ff; border: 1px solid #00e5ff; padding: 15px 40px; font-size: 1rem; cursor: pointer; border-radius: 2px; transition: 0.3s; letter-spacing: 2px; }
        button:hover { background: rgba(0, 229, 255, 0.2); box-shadow: 0 0 20px #00e5ff; }
        #status-line { position: fixed; top: 20px; left: 20px; font-size: 0.8rem; opacity: 0.7; }
    </style>
</head>
<body>
    <div id="status-line">STATUS: OPERATIONAL | LOCATION: TOKIGAWA-SAITAMA</div>
    
    <img id="bg-image" src="img_4844.jpg">
    
    <div id="overlay"></div>
    <div id="content">
        <div id="terminal-text">PROTOCOL "MIKEY" FINAL STANDBY...</div>
        <div class="btn-container">
            <button id="main-btn" onclick="runProtocol()">INITIALIZE</button>
        </div>
    </div>

<script>
    let phase = 0;
    
    // GitHubのファイルリストに基づき、大文字・小文字を正確に記述しました
    const story = [
        { text: "深夜2時。ワークベンチに電流が走った。\n回路図が現実へと動き出す。", img: "img_4844.jpg" },
        { text: "システム同期中。\nロジックボードの深淵へとアクセスを開始。", img: "img_4845.PNG" }, // PNGは大文字
        { text: "警告。未確認の信号を検知。\n物理層とデータ層の境界が曖昧になっています。", img: "img_4846.jpg" },
        { text: "ログ解析... \n過去の設計データと現在の波形が重なり合う。", img: "img_4847.jpg" },
        { text: "特異点到達。\n現実を再定義するためのソースコードが書き換えられました。", img: "img_4856.PNG" }, // PNGは大文字
        { text: "プロトコル完了。\n完璧な世界よりも、未完成の自由を。ログアウト。", img: "img_4857.PNG" }  // PNGは大文字
    ];

    function speakText(text) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const uttr = new SpeechSynthesisUtterance(text);
        uttr.lang = 'ja-JP';
        uttr.rate = 0.9;
        window.speechSynthesis.speak(uttr);
    }

    function typeWriter(text, i, fnCallback) {
        if (i < text.length) {
            document.getElementById('terminal-text').innerHTML = "> " + text.substring(0, i+1).replace(/\n/g, "<br>> ");
            setTimeout(() => typeWriter(text, i + 1, fnCallback), 50);
        } else if (fnCallback) {
            setTimeout(fnCallback, 1500);
        }
    }

    function runProtocol() {
        const btn = document.getElementById('main-btn');
        btn.style.visibility = 'hidden';

        if (phase >= story.length) { 
            location.reload(); 
            return; 
        }
        
        const data = story[phase];
        speakText(data.text.replace(/\n/g, ""));

        const img = document.getElementById('bg-image');
        
        // 画像切り替え時の処理
        img.style.opacity = 0; // 一旦消す
        
        setTimeout(() => {
            img.src = data.img;
            img.onload = () => { 
                img.style.opacity = 0.5; // 読み込み完了したら表示
            };
        }, 300); // 少しだけラグを置いてからソースを切り替え

        typeWriter(data.text, 0, () => {
            btn.style.visibility = 'visible';
            btn.innerText = (phase === story.length - 1) ? "SYSTEM REBOOT" : "NEXT LOG";
            phase++;
        });
    }
</script>
</body>
</html>
